function init_map(){map=new google.maps.Map(document.getElementById("map"),{zoom:zoom,center:london});var a=new google.maps.BicyclingLayer;a.setMap(map),google.maps.event.addListener(map,"click",function(){iw.close()})}function set_map_on_all(a){$.each(markers,function(b,c){c.setMap(a)})}function clear_markers(){set_map_on_all(null)}function show_markers(){set_map_on_all(map)}function delete_markers(){clear_markers(),markers=[]}function add_geolocation(){if("https:"==location.protocol){$("#map").append("<div id='geolocation' class='control-custom'><i class='fa fa-map-marker'></i></div>");var a=$("#geolocation");map.controls[google.maps.ControlPosition.TOP_LEFT].push(a[0]),a.click(function(){function a(a,b,c){b.setPosition(c),b.setContent(a?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var b={lat:a.coords.latitude,lng:a.coords.longitude},c=new google.maps.Marker({map:map,title:"You are here",position:b});iw.setPosition(c.position),iw.setContent(c.title),map.setZoom(18),map.setCenter(c.position),iw.open(map,c),c.addListener("click",function(){iw.setContent("<div>"+c.title+"</div>"),iw.open(map,c)})},function(){a(!0,iw,map.getCenter())}):a(!1,iw,map.getCenter())})}}function add_search(){$("#map").append("<input id='search' class='control-custom' type='text' placeholder='Search'>");var a=$("#search")[0],b=new google.maps.places.SearchBox(a);map.controls[google.maps.ControlPosition.TOP_LEFT].push(a),map.addListener("bounds_changed",function(){b.setBounds(map.getBounds())});var c=[];b.addListener("places_changed",function(){var a=b.getPlaces();if(0!=a.length){c.forEach(function(a){a.setMap(null)}),c=[];var d=new google.maps.LatLngBounds;a.forEach(function(a){if(!a.geometry)return void console.log("Returned place contains no geometry");var b={url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(30,30)},e=new google.maps.Marker({map:map,icon:b,title:a.name+" | "+a.formatted_address,iw_content:"<div><strong>"+a.name+"</strong> | "+a.formatted_address+"</div>",position:a.geometry.location,anchorPoint:new google.maps.Point(-2,-35)});c.push(e),e.addListener("click",function(){iw.setContent("<div>"+e.iw_content+"</div>"),iw.open(map,e)}),a.geometry.viewport?d.union(a.geometry.viewport):d.extend(a.geometry.location)}),map.fitBounds(d)}})}function add_copyright(){var a=document.createElement("div");a.id="copyright";var b=document.createElement("div");b.id="copyright-content",b.innerHTML="<span>Copyright &copy; 2016 <a href='http://sergiu-tripon.com/' target='_blank'>Sergiu Tripon</a></span><span class='hidden-xs'>. Code licensed under <a href='"+license_path+"' target='_blank'>MIT License</a>.</span>",a.appendChild(b),a.index=-1,map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(a)}function get_status(a){$.ajax({url:"https://api.tfl.gov.uk/BikePoint/"+a.id+"?&"+app_id+"&"+app_key}).then(function(a){var b=a.commonName,c="true"==a.additionalProperties[1].value?"Yes":"No",d="true"==a.additionalProperties[2].value?"Yes":"No",e=parseInt(a.additionalProperties[6].value),f=parseInt(a.additionalProperties[7].value),g=parseInt(a.additionalProperties[8].value),h=g-(e+f),i=$("#modal-status");i.html("");var j="<div class='modal-dialog modal-lg' role='document'>";j+="<div class='modal-content'><div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-label='Close'><span class='fa fa-times' aria-hidden='true'></span></button><div class='container-fluid'><div class='row'><div class='col-lg-12'><h1>"+b+"</h1></div></div></div></div>",j+="<div class='modal-body'><div class='container-fluid'><div class='row'>",j+="<div class='col-sm-6 col-md-6 col-lg-6'><div class='item-status'><h4>Installed</h4><h4>"+c+"</h4></div></div><div class='col-sm-6 col-md-6 col-lg-6'><div class='item-status'><h4>Locked</h4><h4>"+d+"</h4></div></div></div><div class='row'><div class='col-sm-6 col-md-3 col-lg-3'><div class='item-status'><h4>Available Bikes</h4><h4>"+e+"</h4></div></div><div class='col-sm-6 col-md-3 col-lg-3'><div class='item-status'><h4>Empty Docks</h4><h4>"+f+"</h4></div></div><div class='col-sm-6 col-md-3 col-lg-3'><div class='item-status'><h4>Total Docks</h4><h4>"+g+"</h4></div></div><div class='col-sm-6 col-md-3 col-lg-3'><div class='item-status'><h4>Broken Docks</h4><h4>"+h+"</h4></div></div></div></div></div>",j+="<div class='modal-footer'><div class='container-fluid'><div class='row'><div class='col-lg-12'><button type='button' class='btn btn-red btn-md' data-dismiss='modal'>Close <i class='fa fa-times'></i></button></div></div></div></div></div></div>",i.append(j),i.modal("show")})}function plot_markers(a){$.each(a,function(a,b){var c=new google.maps.Marker({map:map,id:b.id,title:b.commonName,icon:cycle_image_path,position:{lat:b.lat,lng:b.lon}});markers.push(c),google.maps.event.addListener(c,"click",function(){iw.close(),get_status(c)})})}function get_markers(){$.ajax({url:"https://api.tfl.gov.uk/BikePoint/?&"+app_id+"&"+app_key}).then(function(a){plot_markers(a)})}var app_id="app_id=ee84c96b",app_key="app_key=3aa60311a1e7234f876e281f65056dbe",map,zoom=14,london={lat:51.5286416,lng:-.1015987},markers=[],iw=new google.maps.InfoWindow;$(function(){init_map(),get_markers(),add_geolocation(),add_search(),add_copyright()});